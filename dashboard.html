<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Discord Bot Dashboard</title>
  <link rel="stylesheet" href="static/style.css" />
</head>
<body>
  <!-- Sidebar -->
  <div class="sidebar">
    <img src="https://i.postimg.cc/MHWZgy2W/Untitled-design-7.png" alt="Bot Icon" id="bot-icon" />
    <h2 id="bot-name">Arch Angels</h2>
    
    <!-- User Login/Logout Status -->
    <div id="user-info">
      <span id="user-name">Not logged in</span>
      <img id="user-avatar" src="" alt="User Avatar" style="display: none; width: 40px; height: 40px; border-radius: 50%;" />
    </div>

    <button id="show-dashboard">Dashboard</button>
    <button id="show-raid">Current Raid</button>
    <button id="show-commands">Commands</button>
    <button id="show-leaderboard">Leaderboard</button>

    <button id="log-out-btn" onclick="logout()" style="display: none;">Log Out [➔]</button>
  </div>

  <div class="main-content">
    <!-- Dashboard Section -->
    <div class="page-section" id="dashboard">
      <div id="welcome">
        <img src="" alt="User Avatar" id="welcome-avatar"/>
        <h1>Welcome, <span id="welcome-name">Loading...</span>!</h1>
        <p>This is our official website, developed by @BlakeO_o.</p>
        <p>Please support me by joining our discord ➡️<a href="https://discord.com/invite/A6xhTeGKJg" target="_blank">Arch Angels</a></p>
      </div>
    </div>

    <!-- Current Raid Section -->
    <div class="page-section" id="current_raid" style="display: none;">
      <h1>Current Raid Status</h1>
      <div class="raid-box" id="dedu-island">
        <div class="raid-title">Dedu Island Raid Has Spawned!</div>
        <div class="raid-description">Will you reach the "King"?</div>
        <img src="https://i.postimg.cc/rwSNPy5m/Untitled-design-36.png" alt="Dedu Island" class="raid-image" />
        <div class="raid-footer">Discord.gg/A6xhTeGKJg</div>
      </div>
    </div>

    <!-- Bot Commands Section -->
    <div class="page-section" id="commands" style="display: none;">
      <h1>Bot Commands</h1>
      <div id="command-list"></div> <!-- Dynamically populated by JS -->
    </div>
  </div>

  <script>
    async function logout() {
      window.location.href = "/logout";  // Redirect to logout route
    }

    document.addEventListener('DOMContentLoaded', async () => {
      const userId = getCookie('user_id');
      if (userId) {
        const response = await fetch(`/user/${userId}`);
        const userData = await response.json();
        document.getElementById('user-name').textContent = userData.username;
        document.getElementById('user-avatar').src = userData.avatarUrl;
        document.getElementById('user-avatar').style.display = 'inline';
        document.getElementById('log-out-btn').style.display = 'inline';
        document.getElementById('welcome-name').textContent = userData.username;
      }

      const response = await fetch('/commands');
      const commandsData = await response.json();
      const commandListContainer = document.getElementById('command-list');

      for (let category in commandsData) {
        let categoryTitle = document.createElement('h2');
        categoryTitle.textContent = `${category} Commands`;

        let commandGrid = document.createElement('div');
        commandsData[category].forEach(command => {
          let commandBox = document.createElement('div');
          commandBox.innerHTML = `<div>${command.name}</div><div>${command.description}</div>`;
          commandGrid.appendChild(commandBox);
        });

        commandListContainer.appendChild(categoryTitle);
        commandListContainer.appendChild(commandGrid);
      }
    });

    function getCookie(name) {
      let match = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'));
      return match ? match[2] : null;
    }
  </script>
</body>
</html>
